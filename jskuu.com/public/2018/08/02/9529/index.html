<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="WEB前端开发 - 专注前端开发        -专注前端开发，关注用户体验">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">

    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>rollup 介绍 | WEB前端开发 - 专注前端开发        -专注前端开发，关注用户体验</title>


    <link rel="alternate" href="/atom.xml" title="WEB前端开发 - 专注前端开发        -专注前端开发，关注用户体验" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1274315707 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1274315707%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <wb:follow-button uid="5435940750" type="red_2" width="136" height="24" ></wb:follow-button>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='John Doe'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">WEB前端开发 - 专注前端开发        -专注前端开发，关注用户体验</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="javascript:;"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="javascript:;"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="javascript:;"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="rollup 介绍">
            
	            rollup 介绍
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/08/02</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p>第三方lib库开发工具之 <a href="https://www.rollupjs.com/guide/zh" target="_blank" rel="noopener">rollup</a> </p>
<h2 id="什么是Rollup"><a href="#什么是Rollup" class="headerlink" title="什么是Rollup?"></a>什么是Rollup?</h2><p>rollup是一款用来es6模块打包代码的构建工具(支持css和js打包)。当我们使用ES6模块编写应用或者库时，它可以打包成一个单独文件提供浏览器和Node.js来使用。</p>
<blockquote>
<p>它的优点有如下：</p>
<ul>
<li>能组合我们的脚本文件。</li>
<li>移除未使用的代码(仅仅使用ES6语法中)。</li>
<li>在浏览器中支持使用 Node modules。</li>
<li>压缩文件代码使文件大小尽可能最小化。</li>
</ul>
</blockquote>
<p><em>Rollup最主要的优点是</em> 它是基于ES2015模块的，相比于webpack或Browserify所使用的CommonJS模块更加有效率，因为Rollup使用一种叫做<br>tree-shaking的特性来移除模块中未使用的代码，这也就是说当我们引用一个库的时候，我们只用到一个库的某一段的代码的时候，它不会把所有的代码打包进来，而仅仅打包使用到的代码(webpack2.0+貌似也引入了tree-shaking)。</p>
<p><code>注意：Rollup只会在ES6模块中支持tree-shaking特性。目前按照CommonJS模块编写的jquery不能被支持tree-shaking.</code></p>
<h3 id="rollup-的应用场景"><a href="#rollup-的应用场景" class="headerlink" title="rollup 的应用场景"></a>rollup 的应用场景</h3><p>现在目前流行的打包有 gulp 和 webpack，那么与前面两个对比，我觉得rollup更适合打包js库，但是对于打包一个项目的整个应用的话，我到觉得webpack更适合，比如打包一些图片，字体等资源文件的时候，webpack很适合，目前貌似没有看到rollup可以做到这些。<br>之所以我来研究rollup，是因为最近在看vuex的源码的时候，看到它的js库就是使用rollup来进行打包的。</p>
<h2 id="如何使用Rollup来处理并打包JS文件？"><a href="#如何使用Rollup来处理并打包JS文件？" class="headerlink" title="如何使用Rollup来处理并打包JS文件？"></a>如何使用Rollup来处理并打包JS文件？</h2><h3 id="通过命令行"><a href="#通过命令行" class="headerlink" title="通过命令行"></a>通过命令行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g rollup</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于浏览器：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># compile to a &lt;script&gt; containing a self-executing function ('iife')</span><br><span class="line">$ rollup main.js --file bundle.js --format iife</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于 Node.js:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># compile to a CommonJS module ('cjs')</span><br><span class="line">$ rollup main.js --file bundle.js --format cjs</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于浏览器和 Node.js:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># UMD format requires a bundle name</span><br><span class="line">$ rollup main.js --file bundle.js --format umd --name <span class="string">"myBundle"</span></span><br></pre></td></tr></table></figure>
<h3 id="以下通过配置文件"><a href="#以下通过配置文件" class="headerlink" title="以下通过配置文件"></a>以下通过配置文件</h3><ul>
<li><p>安装Rollup并创建配置文件，通过如下命令安装：进入项目根目录后，运行命令： npm install –save-dev rollup</p>
</li>
<li><p>在项目的根目录下新建一个新文件 rollup.config.js, 之后再在文件中添加如下代码：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>output.format 生成包的格式，有如下格式：</p>
<ol>
<li>amd – 异步模块定义，用于像RequestJS这样的模块加载器。</li>
<li>cjs – CommonJS, 适用于Node或Browserify/webpack</li>
<li>es – 将软件包保存为ES模块文件。</li>
<li>iife – 一个自动执行的功能，适合作为 <code>&lt;script&gt;</code>标签这样的。</li>
<li>umd – 通用模块定义，以amd, cjs, 和 iife 为一体。</li>
</ol>
<p>插一条所有配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 核心选项</span></span><br><span class="line">  input,        <span class="comment">// 要打包的文件</span></span><br><span class="line">  external,     <span class="comment">// 将模块ID的逗号分隔列表排除</span></span><br><span class="line">  plugins,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 额外选项</span></span><br><span class="line">  onwarn,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// danger zone </span></span><br><span class="line">  acorn,</span><br><span class="line">  context,</span><br><span class="line">  moduleContext,</span><br><span class="line">  legacy,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// 如果需要输出多个，可以为数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 核心选项</span></span><br><span class="line">    file,    <span class="comment">// 输出的文件(如果没有这个参数，则直接输出到控制台)</span></span><br><span class="line">    format,  <span class="comment">// 输出的文件类型(amd， cjs, es, iife, umd)</span></span><br><span class="line">    name,    <span class="comment">// 生成UMD模块的名字</span></span><br><span class="line">    global,  <span class="comment">// 以`module ID:Global` 键值对的形式，用逗号分隔开 任何定义在这里模块ID定义添加到外部依赖</span></span><br><span class="line">                              </span><br><span class="line">    <span class="comment">// 额外选项</span></span><br><span class="line">    paths,</span><br><span class="line">    banner,  <span class="comment">// 在打包好的文件的块的外部(wrapper外部)的最顶部插入一段内容</span></span><br><span class="line">    footer,  <span class="comment">// 在打包好的文件的块的外部(wrapper外部)的最底部插入一段内容</span></span><br><span class="line">    intro,   <span class="comment">// 在打包好的文件的块的内部(wrapper内部)的最顶部插入一段内容</span></span><br><span class="line">    outro,   <span class="comment">// 在打包好的文件的块的内部(wrapper内部)的最底部插入一段内容</span></span><br><span class="line">    sourcemap,</span><br><span class="line">    sourcemapFile,</span><br><span class="line">    interop,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 高危选项</span></span><br><span class="line">    exports,</span><br><span class="line">    amd,</span><br><span class="line">    indent,</span><br><span class="line">    strict</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面再来了解一下各个配置的含义：<br>input： rollup先执行的入口文件。<br>output：rollup 输出的文件。<br>output.format: rollup支持的多种输出格式(有amd,cjs, es, iife 和 umd, 具体看 </p>
<p>我们在package.json代码下 添加如下脚本。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"rollup -c"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因此我们只要在命令行中 输入命令：npm run build 即可完成打包；</p>
<p>我们再看下各个文件下的代码：</p>
<p>src/js/a.js 代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="string">`Later, <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>src/js/b.js代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds all the values in an array.</span></span><br><span class="line"><span class="comment"> * @param  &#123;Array&#125; arr an array of numbers</span></span><br><span class="line"><span class="comment"> * @return &#123;Number&#125;    the sum of all the array values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addArray = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> addArray;</span><br></pre></td></tr></table></figure>
<p>src/main.js代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./js/a'</span>;</span><br><span class="line"><span class="keyword">import</span> addArray <span class="keyword">from</span> <span class="string">'./js/b'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res1);</span><br><span class="line"><span class="built_in">console</span>.log(res2);</span><br></pre></td></tr></table></figure>
<p>最终会在项目的根目录下生成文件 dist/js/main.min.js, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds all the values in an array.</span></span><br><span class="line"><span class="comment"> * @param  &#123;Array&#125; arr an array of numbers</span></span><br><span class="line"><span class="comment"> * @return &#123;Number&#125;    the sum of all the array values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addArray = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res1);</span><br><span class="line"><span class="built_in">console</span>.log(res2);</span><br><span class="line"></span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>如上可以看到 在 src/js/a.js 下的 b函数没有被使用到，所以打包的时候没有被打包进来。</p>
<blockquote>
<p>注意：在上面代码打包后，只有现代浏览器会正常工作，如果要让不支持ES2015的旧版本浏览器下也正常工作的话，我们需要添加一些插件。</p>
</blockquote>
<h2 id="设置Babel来使旧浏览器也支持ES6的代码"><a href="#设置Babel来使旧浏览器也支持ES6的代码" class="headerlink" title="设置Babel来使旧浏览器也支持ES6的代码"></a>设置Babel来使旧浏览器也支持ES6的代码</h2><p>如上打包后的代码，我们可以在现代浏览器下运行了，但是如果我们使用老版本的浏览器的话，就会产生错误。幸运的是，Babel已经提供了支持。<br>我们首先需要安装一些依赖项如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev </span><br><span class="line">babel-core babel-preset-env babel-plugin-external-helpers </span><br><span class="line">babel-plugin-transform-runtime babel-preset-stage-2 </span><br><span class="line">babel-register rollup-plugin-babel</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：Babel preset 是一个有关Babel插件的集合，它会告诉Babel我们需要转译什么。</p>
</blockquote>
<h3 id="创建-babelrc文件"><a href="#创建-babelrc文件" class="headerlink" title="创建 .babelrc文件"></a>创建 .babelrc文件</h3><p> 接下来需要在项目的根目录下创建 .babelrc的新文件了，它内部添加如下JSON代码：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>, &#123;</span><br><span class="line">      <span class="string">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">"targets"</span>: &#123;</span><br><span class="line">        <span class="string">"browsers"</span>: [<span class="string">"&gt; 1%"</span>, <span class="string">"last 2 versions"</span>, <span class="string">"not ie &lt;= 8"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>, <span class="string">"external-helpers"</span>]  <span class="comment">// 配置runtime，不设置会报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它会告诉Babel应该使用哪种preset来转译代码。</p>
<p>因此我们再更新下 rollup.config.js，我们需要Babel插件，将它添加到一个新的配置选项plugins中，他会管控一个数组形式的插件列表，代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rollup plugins</span></span><br><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    babel(&#123;</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span>  <span class="comment">// 排除node_module下的所有文件</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了避免转译第三方脚本，我们需要设置一个 exclude 的配置选项来忽略掉 node_modules 目录下的所有文件。安装完成后，我们重新运行命令；然后打包后代码变成如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> temp = <span class="string">"Hello, "</span> + name + <span class="string">"!"</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds all the values in an array.</span></span><br><span class="line"><span class="comment"> * @param  &#123;Array&#125; arr an array of numbers</span></span><br><span class="line"><span class="comment"> * @return &#123;Number&#125;    the sum of all the array values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> addArray = <span class="function"><span class="keyword">function</span> <span class="title">addArray</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">var</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res1);</span><br><span class="line"><span class="built_in">console</span>.log(res2);</span><br><span class="line"></span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>我们对比下代码，可以看到 addArray 的箭头函数解析成真正的函数了。 在转译运行完成后，代码也差不多一样的，只是代码已经支持<br>了IE9之前的浏览器了。</p>
<blockquote>
<p>注意： Babel也提供了 babel-polyfill， 也可以让IE8之前的浏览器能够顺利执行。</p>
</blockquote>
<h2 id="添加一个debug包来记录日志"><a href="#添加一个debug包来记录日志" class="headerlink" title="添加一个debug包来记录日志"></a>添加一个debug包来记录日志</h2><p>为了查看日志，我们将在代码中添加一个debug包来记录下日志信息。通过如下命令安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save debug</span><br></pre></td></tr></table></figure>
<p>然后我们可以在 src/main.js中，添加一些简单的日志记录：如下代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./js/a'</span>;</span><br><span class="line"><span class="keyword">import</span> addArray <span class="keyword">from</span> <span class="string">'./js/b'</span>;</span><br><span class="line"><span class="keyword">import</span> debug <span class="keyword">from</span> <span class="string">'debug'</span>;</span><br><span class="line"><span class="keyword">const</span> log = debug(<span class="string">'app:log'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enable the logger.</span></span><br><span class="line">debug.enable(<span class="string">'*'</span>);</span><br><span class="line">log(<span class="string">'Logging is enabled!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the results on the page.</span></span><br><span class="line"><span class="keyword">const</span> printTarget = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'debug__output'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">printTarget.innerText = <span class="string">`sayHelloTo('Jason') =&gt; <span class="subst">$&#123;res1&#125;</span>\n\n`</span>;</span><br><span class="line">printTarget.innerText += <span class="string">`addArray([1, 2, 3, 4]) =&gt; <span class="subst">$&#123;res2&#125;</span>`</span>;</span><br></pre></td></tr></table></figure></p>
<p>index.html 代码变成如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">content</span>=<span class="string">"width=device-width,minimum-scale=1,initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Learning Rollup<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Learning Rollup<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    Let’s learn how to use <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://rollupjs.org/"</span>&gt;</span>Rollup<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- JS-generated output will be added here. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">"debug"</span>&gt;</span><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">"debug__output"</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- This is the bundle generated by rollup.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./dist/js/main.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们直接访问index.html后，浏览器控制台报错了，错误信息如下：<br>Uncaught ReferenceError: debug is not defined，然后我们可以继续查看，打包后的main.min.js的代码变为如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">debug</span>) </span>&#123;</span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line">debug = debug &amp;&amp; debug.hasOwnProperty(<span class="string">'default'</span>) ? debug[<span class="string">'default'</span>] : debug;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> temp = <span class="string">"Hello, "</span> + name + <span class="string">"!"</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds all the values in an array.</span></span><br><span class="line"><span class="comment"> * @param  &#123;Array&#125; arr an array of numbers</span></span><br><span class="line"><span class="comment"> * @return &#123;Number&#125;    the sum of all the array values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> addArray = <span class="function"><span class="keyword">function</span> <span class="title">addArray</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> log = debug(<span class="string">'app:log'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enable the logger.</span></span><br><span class="line">debug.enable(<span class="string">'*'</span>);</span><br><span class="line">log(<span class="string">'Logging is enabled!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">var</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the results on the page.</span></span><br><span class="line"><span class="keyword">var</span> printTarget = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'debug__output'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">printTarget.innerText = <span class="string">'sayHelloTo(\'Jason\') =&gt; '</span> + res1 + <span class="string">'\n\n'</span>;</span><br><span class="line">printTarget.innerText += <span class="string">'addArray([1, 2, 3, 4]) =&gt; '</span> + res2;</span><br><span class="line"></span><br><span class="line">&#125;(debug));</span><br></pre></td></tr></table></figure>
<p>也就是说 浏览器报错是因为打包后的debug是 undefined，这是因为一般的情况下，第三方node模块并不会被Rollup正确加载。<br>Node模块使用的是CommonJS, 它不会被Rollup兼容因此不能直接被使用，为了解决这个问题，我们需要添加一些插件来<br>处理Node依赖和CommonJS模块。<br>为了解决上面的两个问题，我们需要在Rollup中添加如下两个插件：</p>
<ol>
<li>rollup-plugin-node-resolve 该插件会允许加载在 node_modules中的第三方模块。</li>
<li>rollup-plugin-commonjs 它会将CommonJS模块转换为ES6来为Rollup获得兼容。</li>
</ol>
<p>因此如下命令即可安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev rollup-plugin-node-resolve rollup-plugin-commonjs</span><br></pre></td></tr></table></figure>
<p>然后我们继续更新下 rollup.config.js 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rollup plugins</span></span><br><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span>;</span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">'rollup-plugin-commonjs'</span>;</span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    resolve(&#123;</span><br><span class="line">      jsnext: <span class="literal">true</span>,  <span class="comment">// 该属性是指定将Node包转换为ES2015模块</span></span><br><span class="line">      <span class="comment">// main 和 browser 属性将使插件决定将那些文件应用到bundle中</span></span><br><span class="line">      main: <span class="literal">true</span>,  <span class="comment">// Default: true </span></span><br><span class="line">      browser: <span class="literal">true</span> <span class="comment">// Default: false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    commonjs(),</span><br><span class="line">    json(),</span><br><span class="line">    babel(&#123;</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span>  <span class="comment">// 排除node_modules 下的文件</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到目前为止一切顺利，但是当我们运行index.html时候， rollup 时我们会得到一个日志信息：</p>
<p>在控制台如下日志信息：<br>app:log Logging is enabled! +0ms</p>
<p>index.html 页面上显示如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Learning Rollup</span><br><span class="line">Let’s learn how to use Rollup.</span><br><span class="line"></span><br><span class="line">sayHelloTo(<span class="string">'Jason'</span>) =&gt; Hello, kongzhi!</span><br><span class="line"></span><br><span class="line">addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]) =&gt; <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>如上代码，我们看到引入了 rollup-plugin-json 插件了，该插件的作用是读取json信息的，比如我读取package.json的信息:</p>
<p>然后我把main.js中引入对应代码。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./js/a'</span>;</span><br><span class="line"><span class="keyword">import</span> addArray <span class="keyword">from</span> <span class="string">'./js/b'</span>;</span><br><span class="line"><span class="keyword">import</span> debug <span class="keyword">from</span> <span class="string">'debug'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加json</span></span><br><span class="line"><span class="keyword">import</span> pkg <span class="keyword">from</span> <span class="string">'../package.json'</span>;</span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">`running version <span class="subst">$&#123;pkg.version&#125;</span>`</span> ); <span class="comment">// 控制台输出 running version 1.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> log = debug(<span class="string">'app:log'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enable the logger.</span></span><br><span class="line">debug.enable(<span class="string">'*'</span>);</span><br><span class="line">log(<span class="string">'Logging is enabled!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the results on the page.</span></span><br><span class="line"><span class="keyword">const</span> printTarget = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'debug__output'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">printTarget.innerText = <span class="string">`sayHelloTo('Jason') =&gt; <span class="subst">$&#123;res1&#125;</span>\n\n`</span>;</span><br><span class="line">printTarget.innerText += <span class="string">`addArray([1, 2, 3, 4]) =&gt; <span class="subst">$&#123;res2&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>
<p>在控制台输出如下信息：<br>控制台输出 running version 1.0.0</p>
<h2 id="添加插件来替代环境变量"><a href="#添加插件来替代环境变量" class="headerlink" title="添加插件来替代环境变量"></a>添加插件来替代环境变量</h2><p>环境变量能为我们的开发流程提供很大的帮助，我们可以通过它来执行关闭或开启日志，注入开发环境脚本等功能。<br>因此我们可以在main.js中添加基础配置的ENV。让我们添加一个环境变量来使我们的日志脚本只在非 production环境下才会执行<br>。如下main.js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">'./js/a'</span>;</span><br><span class="line"><span class="keyword">import</span> addArray <span class="keyword">from</span> <span class="string">'./js/b'</span>;</span><br><span class="line"><span class="keyword">import</span> debug <span class="keyword">from</span> <span class="string">'debug'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加json</span></span><br><span class="line"><span class="keyword">import</span> pkg <span class="keyword">from</span> <span class="string">'../package.json'</span>;</span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">`running version <span class="subst">$&#123;pkg.version&#125;</span>`</span> ); <span class="comment">// 控制台输出 running version 1.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> log = debug(<span class="string">'app:log'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是正式环境的话，不输出日志信息</span></span><br><span class="line"><span class="keyword">if</span> (ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">  <span class="comment">// Enable the logger.</span></span><br><span class="line">  debug.enable(<span class="string">'*'</span>);</span><br><span class="line">  log(<span class="string">'Logging is enabled!'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  debug.disable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res1 = a(<span class="string">'kongzhi'</span>);</span><br><span class="line"><span class="keyword">const</span> res2 = addArray([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print the results on the page.</span></span><br><span class="line"><span class="keyword">const</span> printTarget = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'debug__output'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">printTarget.innerText = <span class="string">`sayHelloTo('Jason') =&gt; <span class="subst">$&#123;res1&#125;</span>\n\n`</span>;</span><br><span class="line">printTarget.innerText += <span class="string">`addArray([1, 2, 3, 4]) =&gt; <span class="subst">$&#123;res2&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>
<p>然后打包完成后，在浏览器查看 发现报错了，如下错误信息：<br>Uncaught ReferenceError: ENV is not defined<br>这也很正常，因为我们并没有定义它，现在我们还需要一个插件来将我们的环境变量用到bundle中。</p>
<p>5-1 先安装 rollup-plugin-replcae，该插件是一个用来查找和替换的工作，我们只需要找到目前的环境变量并且使用实际<br>的值替代就可以了。先安装如下：<br>npm install –save-dev rollup-plugin-replace</p>
<p>然后我们再来更新一下 rollup.config.js, 配置是我们可以添加一个 key:value 的配对表，key值是准备被替换的键，而value是将要被替换的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rollup plugins</span></span><br><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span>;</span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">'rollup-plugin-commonjs'</span>;</span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span>;</span><br><span class="line"><span class="keyword">import</span> replace <span class="keyword">from</span> <span class="string">'rollup-plugin-replace'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    resolve(&#123;</span><br><span class="line">      jsnext: <span class="literal">true</span>,  <span class="comment">// 该属性是指定将Node包转换为ES2015模块</span></span><br><span class="line">      <span class="comment">// main 和 browser 属性将使插件决定将那些文件应用到bundle中</span></span><br><span class="line">      main: <span class="literal">true</span>,  <span class="comment">// Default: true </span></span><br><span class="line">      browser: <span class="literal">true</span> <span class="comment">// Default: false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    commonjs(),</span><br><span class="line">    json(),</span><br><span class="line">    babel(&#123;</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span>  <span class="comment">// 排除node_modules 下的文件</span></span><br><span class="line">    &#125;),</span><br><span class="line">    replace(&#123;</span><br><span class="line">      ENV: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'development'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们现在运行 npm run build 的时候还是有日志信息的，因为默认的环境就是 development， 但是当我们在命令<br>行中使用如下命令：<code>NODE_ENV=production ./node_modules/.bin/rollup -c</code>(mac系统下的命令)， 然后打包<br>后，刷新浏览器 就不会有日志记录信息了。<br>注意：在winodw环境下，运行如下命令： SET NODE_ENV=production ./node_modules/.bin/rollup -c</p>
<h2 id="添加-UglifyJS来压缩我们js的代码"><a href="#添加-UglifyJS来压缩我们js的代码" class="headerlink" title="添加 UglifyJS来压缩我们js的代码"></a>添加 UglifyJS来压缩我们js的代码</h2><p>安装插件 rollup-plugin-uglify</p>
<p>命令如下安装：<br>npm install –save-dev rollup-plugin-uglify</p>
<p>再在 rollup.config.js 配置代码，为了在开发中使代码更具可读性，我们只在生产环境压缩代码：<br>rollup.config.js配置代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rollup plugins</span></span><br><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span>;</span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">'rollup-plugin-commonjs'</span>;</span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span>;</span><br><span class="line"><span class="keyword">import</span> replace <span class="keyword">from</span> <span class="string">'rollup-plugin-replace'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; uglify &#125; <span class="keyword">from</span> <span class="string">'rollup-plugin-uglify'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    resolve(&#123;</span><br><span class="line">      jsnext: <span class="literal">true</span>,  <span class="comment">// 该属性是指定将Node包转换为ES2015模块</span></span><br><span class="line">      <span class="comment">// main 和 browser 属性将使插件决定将那些文件应用到bundle中</span></span><br><span class="line">      main: <span class="literal">true</span>,  <span class="comment">// Default: true </span></span><br><span class="line">      browser: <span class="literal">true</span> <span class="comment">// Default: false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    commonjs(),</span><br><span class="line">    json(),</span><br><span class="line">    babel(&#123;</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span>  <span class="comment">// 排除node_modules 下的文件</span></span><br><span class="line">    &#125;),</span><br><span class="line">    replace(&#123;</span><br><span class="line">      ENV: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'development'</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    (process.env.NODE_ENV === <span class="string">'production'</span> &amp;&amp; uglify())</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们在mac系统下运行命令 <code>NODE_ENV=production ./node_modules/.bin/rollup -c</code> 后，代码被压缩了，当我们运行<br>npm run build 的时候，代码未被压缩。</p>
<h2 id="监听文件变化的插件-—-rollup-watch"><a href="#监听文件变化的插件-—-rollup-watch" class="headerlink" title="监听文件变化的插件 — rollup-watch"></a>监听文件变化的插件 — rollup-watch</h2><p>如下安装命令：<br>npm install –save-dev rollup-watch</p>
<p>然后在package.json 中设置 scripts属性即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"rollup -c -w"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"rollup -c"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们在 src/main.js 代码下 加入一句代码后 ： console.log(1122); 然后在浏览器下刷新下即可在控制台可以看到打印输出 1122这样的就可以监听到了。不需要重新打包即可。</p>
<h2 id="开启本地服务的插件-—-rollup-plugin-serve"><a href="#开启本地服务的插件-—-rollup-plugin-serve" class="headerlink" title="开启本地服务的插件 — rollup-plugin-serve"></a>开启本地服务的插件 — rollup-plugin-serve</h2><p> 安装命令如下：</p>
<p>npm install –save-dev rollup-plugin-serve</p>
<p>在rollup.config.js 配置代码如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rollup plugins</span></span><br><span class="line"><span class="keyword">import</span> babel <span class="keyword">from</span> <span class="string">'rollup-plugin-babel'</span>;</span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span>;</span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">'rollup-plugin-commonjs'</span>;</span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span>;</span><br><span class="line"><span class="keyword">import</span> replace <span class="keyword">from</span> <span class="string">'rollup-plugin-replace'</span>;</span><br><span class="line"><span class="keyword">import</span> uglify <span class="keyword">from</span> <span class="string">'rollup-plugin-uglify'</span>;</span><br><span class="line"><span class="keyword">import</span> serve <span class="keyword">from</span> <span class="string">'rollup-plugin-serve'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'./dist/js/main.min.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    resolve(&#123;</span><br><span class="line">      jsnext: <span class="literal">true</span>,  <span class="comment">// 该属性是指定将Node包转换为ES2015模块</span></span><br><span class="line">      <span class="comment">// main 和 browser 属性将使插件决定将那些文件应用到bundle中</span></span><br><span class="line">      main: <span class="literal">true</span>,  <span class="comment">// Default: true </span></span><br><span class="line">      browser: <span class="literal">true</span> <span class="comment">// Default: false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    commonjs(),</span><br><span class="line">    json(),</span><br><span class="line">    babel(&#123;</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span>  <span class="comment">// 排除node_modules 下的文件</span></span><br><span class="line">    &#125;),</span><br><span class="line">    replace(&#123;</span><br><span class="line">      ENV: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'development'</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    (process.env.NODE_ENV === <span class="string">'production'</span> &amp;&amp; uglify()),</span><br><span class="line">    serve(&#123;</span><br><span class="line">      open: <span class="literal">true</span>, <span class="comment">// 是否打开浏览器</span></span><br><span class="line">      contentBase: <span class="string">'./'</span>, <span class="comment">// 入口html的文件位置</span></span><br><span class="line">      historyApiFallback: <span class="literal">true</span>, <span class="comment">// Set to true to return index.html instead of 404</span></span><br><span class="line">      host: <span class="string">'localhost'</span>,</span><br><span class="line">      port: <span class="number">10001</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后重启命令 npm run build 就可以会自动打开 <a href="http://localhost:10001/" target="_blank" rel="noopener">http://localhost:10001/</a> 页面了。<br>注意： 这边port配置的端口号是五位数，不是四位数。</p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">快乐至上</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2018/07/31/9528/" class="next-post btn btn-default" title='关于-webkit-的一些用法'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">关于-webkit-的一些用法</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Rollup"><span class="toc-text">什么是Rollup?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rollup-的应用场景"><span class="toc-text">rollup 的应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何使用Rollup来处理并打包JS文件？"><span class="toc-text">如何使用Rollup来处理并打包JS文件？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#通过命令行"><span class="toc-text">通过命令行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#以下通过配置文件"><span class="toc-text">以下通过配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置Babel来使旧浏览器也支持ES6的代码"><span class="toc-text">设置Babel来使旧浏览器也支持ES6的代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-babelrc文件"><span class="toc-text">创建 .babelrc文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加一个debug包来记录日志"><span class="toc-text">添加一个debug包来记录日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加插件来替代环境变量"><span class="toc-text">添加插件来替代环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加-UglifyJS来压缩我们js的代码"><span class="toc-text">添加 UglifyJS来压缩我们js的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#监听文件变化的插件-—-rollup-watch"><span class="toc-text">监听文件变化的插件 — rollup-watch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开启本地服务的插件-—-rollup-plugin-serve"><span class="toc-text">开启本地服务的插件 — rollup-plugin-serve</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>❤</span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>