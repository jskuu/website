---
title: React.Component
---


ä»¥ä¸‹ *unstable_AsyncComponent* åœ¨16.3.0çš„æ—¶å€™è¢«æ”¹å *unstable_AsyncMode*

### ç»„ä»¶æœ¬è´¨æ˜¯å¯¹è±¡

![1](https://user-images.githubusercontent.com/25027560/36943140-79bcc8de-1fbe-11e8-96f0-98939acce31a.png)

![2](https://user-images.githubusercontent.com/25027560/36943143-7f599b3c-1fbe-11e8-96cf-8f32a522154b.png)

å…¶å®å°±æ˜¯ä¸ªå¯¹è±¡ï¼Œæœ‰å¾ˆå¤šå±æ€§ï¼Œæ³¨æ„åˆ°propsé‡Œé¢ï¼Œ æ²¡æœ‰å†…å®¹
ç»™ç»„ä»¶Aé‡Œé¢åŒ…å«ä¸€ç‚¹å†…å®¹


```js
componentDidMount() {
    console.log('ç»„ä»¶A',<A><span>åŠ ç‚¹å†…å®¹çœ‹çœ‹</span></A>)
}
  ```

![3](https://user-images.githubusercontent.com/25027560/36943144-869d0384-1fbe-11e8-8fe0-33777003cef2.png)

å¯ä»¥çœ‹åˆ°ï¼Œprops.childrené‡Œé¢å¼€å§‹åµŒå¥—å†…å®¹äº†
é‚£ä»¥æˆ‘ä»¬èªæ˜çš„ç¨‹åºå‘˜çš„é€»è¾‘æ¥æ¨ç†ä¸€ä¸‹ï¼Œå…¶å®ä¸æ–­çš„é¡µé¢åµŒå¥—ï¼Œå°±æ˜¯ä¸æ–­çš„ç»™è¿™ä¸ªå¯¹è±¡åµŒå¥—propsè€Œå·²
ä¸ä¿¡å†çœ‹ä¸€ä¸‹



```js
componentDidMount() {
    console.log('ç»„ä»¶A',<A><span>åŠ ç‚¹å†…å®¹çœ‹çœ‹<a>ä¸ä¿¡å†åŠ å¤šä¸€ç‚¹</a></span></A>)
  }
```

![4](https://user-images.githubusercontent.com/25027560/36943146-8e04f5fa-1fbe-11e8-9a3e-707e06cffed6.png)

## è™šæ‹ŸDOMæ¦‚å¿µ
æ‰€ä»¥åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†reactçš„ç»„ä»¶åªæ˜¯å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬éƒ½çŸ¥é“çœŸæ­£çš„é¡µé¢æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„DOMèŠ‚ç‚¹ç»„æˆçš„ï¼Œåœ¨æ¯”è¾ƒåŸç”Ÿçš„jQueryå¹´ä»£ï¼Œé€šè¿‡JSæ¥æ“çºµDOMå…ƒç´ ï¼Œè€Œä¸”éƒ½æ˜¯çœŸå®çš„DOMå…ƒç´ ï¼Œè€Œä¸”æˆ‘ä»¬éƒ½çŸ¥é“å¤æ‚æˆ–é¢‘ç¹çš„DOMæ“ä½œé€šå¸¸æ˜¯æ€§èƒ½ç“¶é¢ˆäº§ç”Ÿçš„åŸå› 
æ‰€ä»¥Reactå¼•å…¥äº†è™šæ‹ŸDOMï¼ˆVirtual DOMï¼‰çš„æ¦‚å¿µ
æ€»çš„è¯´èµ·æ¥ï¼Œæ— è®ºå¤šå¤æ‚çš„æ“ä½œï¼Œéƒ½åªæ˜¯å…ˆè¿›è¡Œè™šæ‹ŸDOMçš„JSè®¡ç®—ï¼ŒæŠŠè¿™ä¸ªç»„ä»¶å¯¹è±¡è®¡ç®—å¥½äº†ä»¥åï¼Œå†ä¸€æ¬¡æ€§çš„é€šè¿‡Diffç®—æ³•è¿›è¡Œæ¸²æŸ“æˆ–è€…æ›´æ–°ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è¦ç›´æ¥æ“ä½œçœŸå®çš„DOMã€‚
åœ¨å³æ—¶ç¼–è¯‘çš„æ—¶ä»£ï¼Œè°ƒç”¨DOMçš„å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚è€ŒVirtual DOMçš„æ‰§è¡Œå®Œå…¨éƒ½åœ¨Javascript å¼•æ“ä¸­ï¼Œå®Œå…¨ä¸ä¼šæœ‰è¿™ä¸ªå¼€é”€ã€‚

çŸ¥é“äº†ä»€ä¹ˆæ˜¯è™šæ‹ŸDOMä»¥åŠç»„ä»¶çš„æœ¬è´¨åï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€ä¸‹ä»£ç å§
å…ˆä»ç”Ÿæˆç»„ä»¶å¼€å§‹åˆ‡å…¥ï¼Œå› ä¸ºè¦ç”Ÿæˆç»„ä»¶å°±è‚¯å®šä¼šå»æ‰¾ç»„ä»¶æ˜¯ä»€ä¹ˆ
createElement: createElementWithValidation,

## ç»„ä»¶çš„æœ¬æº
çŸ¥é“äº†ç»„ä»¶æ˜¯å¯¹è±¡åï¼Œæˆ‘ä»¬å»çœ‹çœ‹å®ƒçš„æœ¬æº

æ‘˜å–ä¸€äº›æ ¸å¿ƒæ¦‚å¿µå‡ºæ¥çœ‹å°±å¥½


```js
function createElementWithValidation(type, props, children) {
  var element = createElement.apply(this, arguments);
  return element;
}
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›äº†ä¸€ä¸ªelementï¼Œè¿™ä¸ªå…ƒç´ åˆæ˜¯ç”±createElementæ–¹æ³•ç”Ÿæˆçš„ï¼Œé¡ºç€å¾€ä¸‹æ‰¾

```js
function createElement(type, config, children) {
  var props = {};
  var key = null;
  var ref = null;
  var self = null;
  var source = null;

  return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);
}
```
è¿”å›çš„æ˜¯ReactElementæ–¹æ³•ï¼Œæ„Ÿè§‰å·²ç»å¾ˆè¿‘äº†ï¼Œé©¬ä¸Šè¦è§¦åŠæœ¬æºäº†
```js
var ReactElement = function (type, key, ref, self, source, owner, props) {
  var element = {
    $$typeof: REACT_ELEMENT_TYPE,
    type: type,
    key: key,
    ref: ref,
    props: props,
    _owner: owner
  };
  return element;
};
```
è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå†çœ‹è¿™ä¸ªå¯¹è±¡ï¼Œæ˜¯ä¸æ˜¯è·Ÿä¸Šé¢æ‰“å°å‡ºæ¥çš„å¯¹è±¡æ ¼å¼å¾ˆåƒï¼Ÿå†çœ‹ä¸€çœ¼


![6](https://user-images.githubusercontent.com/25027560/36943148-97a738de-1fbe-11e8-8d69-1d636d1c3ec3.png)

## è¿™å°±æ˜¯ç»„ä»¶çš„æœ¬æº

ç»„ä»¶ä¸‰ç§åŸºç±»
å‰é¢è¯´äº†ï¼Œç‰ˆæœ¬16ä»¥åï¼Œå°è£…äº†ä¸‰ç§ç»„ä»¶åŸºç±»ï¼šåˆ†åˆ«æ˜¯ç»„ä»¶ã€çº¯ç»„ä»¶ã€å¼‚æ­¥ç»„ä»¶

```js
Component: Component,
PureComponent: PureComponent,
unstable_AsyncComponent: AsyncComponent,
```
ä¸€ä¸ªä¸ªå»çœ‹ä¸€ä¸‹åŒºåˆ«åœ¨å“ªé‡Œï¼Œå…ˆçœ‹** Component**

```js
function Component(props, context, updater) {
  this.props = props;
  this.context = context;
  this.refs = emptyObject;
  this.updater = updater || ReactNoopUpdateQueue;
}
```
å¾ˆç®€å•ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œé€šè¿‡å®ƒæ„é€ çš„å®ä¾‹å¯¹è±¡æœ‰ä¸‰ä¸ªç§æœ‰å±æ€§ï¼Œrefsåˆ™æ˜¯ä¸ªemptyObjectï¼Œçœ‹åå­—å°±çŸ¥é“æ˜¯ç©ºå¯¹è±¡
è¿™ä¸ªemptyObjectä¹Ÿæ˜¯å¼•å…¥çš„æ’ä»¶
var emptyObject = require('fbjs/lib/emptyObject');

å†å»çœ‹PureComponentï¼ŒAsyncComponentï¼Œå®šä¹‰çš„æ—¶å€™å±…ç„¶è·ŸComponentæ˜¯ä¸€æ ·çš„

![7](https://user-images.githubusercontent.com/25027560/36943150-a0871f5a-1fbe-11e8-85ce-437908d8a3c6.png)

éƒ½æ˜¯è¿™å››å¥è¯

```js
this.props = props;
  this.context = context;
  this.refs = emptyObject;
  this.updater = updater || ReactNoopUpdateQueue;
  ```

  åŒºåˆ«å‘¢ï¼Ÿè¿™é‡Œå°±è¦æ¯”è¾ƒç†è§£åŸå‹é“¾æ–¹é¢çš„çŸ¥è¯†äº†
è™½ç„¶åŸå‹å’Œç»§æ‰¿åœ¨æ—¥å¸¸é¡¹ç›®å’Œå·¥ä½œä¸­ç”¨çš„ä¸å¤šï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œä½†æƒ³è¦è¿›é˜¶ï¼Œå°±è¦å»è¯»åˆ«äººçš„æºç ï¼Œå»è‡ªå·±å°è£…ç»„ä»¶ï¼Œè¿™äº‹å®ƒä»¬å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬å¾ˆé‡è¦çš„åŸå› ã€‚

æ ¸å¿ƒçš„æ–¹æ³•ï¼Œå’Œå±æ€§ï¼Œä»¥åŠè¿™ä¸‰ç§ç»„ä»¶ç›´æ¥çš„å…³ç³»éƒ½æ˜¯é€šè¿‡åŸå‹çš„çŸ¥è¯†è”ç³»èµ·æ¥çš„ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ç”»äº†ä¸ªç®€å›¾ï¼Œå¸Œæœ›èƒ½å¯¹çœ‹æ–‡ç« çš„å„ä½æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰ç”»é”™çš„ï¼Œå¸Œæœ›èƒ½æŒ‡æ­£æˆ‘

å…ˆä¸Šæ ¸å¿ƒä»£ç 
setStateå’ŒforceUpdateè¿™ä¸¤ä¸ªæ–¹æ³•æŒ‚è½½Componentï¼ˆç»„ä»¶æ„é€ å™¨ï¼‰çš„åŸå‹ä¸Š

```js
Component.prototype.setState = function (partialState, callback) {
  ...
};

Component.prototype.forceUpdate = function (callback) {
  ...
};
```

å®šä¹‰ä¸€ä¸ªComponentDummyï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼ŒæŒ‰ç…§åå­—æ¥ç†è§£å°±æ˜¯â€œå‡ç»„ä»¶â€ğŸ˜‚ï¼Œå®ƒæ˜¯å½“åšè¾…åŠ©ç”¨çš„

è®©ComponentDummyçš„åŸå‹æŒ‡å‘Componentçš„åŸå‹ï¼Œè¿™æ ·å®ƒä¹Ÿèƒ½è®¿é—®åŸå‹ä¸Šé¢çš„å…±æœ‰æ–¹æ³•å’Œå±æ€§äº†ï¼Œæ¯”å¦‚setStateå’ŒforceUpdate

```js

function ComponentDummy() {}
ComponentDummy.prototype = Component.prototype;
```
è¿™å¥è¯ï¼Œå‡ç»„ä»¶æ„é€ å™¨ComponentDummyå®ä¾‹åŒ–å‡ºæ¥ä¸€ä¸ªå¯¹è±¡pureComponentPrototypeï¼Œç„¶åæŠŠè¿™ä¸ªå¯¹è±¡çš„constructorå±æ€§åˆæŒ‡å‘äº†PureComponentï¼Œå› æ­¤PureComponentä¹Ÿæˆä¸ºäº†ä¸€ä¸ªæ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬äºŒç§ç»„ä»¶åŸºç±»
```js

var pureComponentPrototype = PureComponent.prototype = new ComponentDummy();
pureComponentPrototype.constructor = PureComponent;
```
AsyncComponentåŸºç±»ä¹Ÿæ˜¯ä¸€æ ·
```js

var asyncComponentPrototype = AsyncComponent.prototype = new ComponentDummy();
asyncComponentPrototype.constructor = AsyncComponent;
```
ä½†æ˜¯AsyncComponentçš„åŸå‹å¤šäº†ä¸€ä¸ªæ–¹æ³•renderï¼Œçœ‹åˆ°äº†å—ï¼Œå¦ˆå¦ˆå‘€ï¼Œè¿™å°±æ˜¯renderçš„å‡ºå¤„
```js
asyncComponentPrototype.render = function () {
  return this.props.children;
};
```
æ‰€ä»¥åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ªåŸå‹å›¾


![8](https://user-images.githubusercontent.com/25027560/36943153-aad01ab6-1fbe-11e8-8b7d-d24d955fa1b5.png)

ä½†æ˜¯ï¼Œæœ‰ä¸ªé—®é¢˜æ¥äº†ï¼Œrenderæ–¹æ³•æŒ‚è½½åœ¨AsyncComponentçš„åŸå‹ä¸Šï¼Œé‚£é€šè¿‡Componentæ„é€ å™¨æ„é€ å‡ºæ¥çš„å®ä¾‹å²‚ä¸æ˜¯è¯»ä¸åˆ°renderæ–¹æ³•ï¼Œé‚£ä¸ºä»€ä¹ˆæ—¥å¸¸ç»„ä»¶æ˜¯è¿™æ ·å†™çš„ï¼Ÿ

![9](https://user-images.githubusercontent.com/25027560/36943154-b2e23fd6-1fbe-11e8-90f7-e5a7022e8a49.png)

è¿˜æœ‰ä¸¤å¥ä»£ç ï¼Œä¸Šé¢åšäº†ä¸ªå°å‰§é€çš„_assign
```js
// Avoid an extra prototype jump for these methods.
_assign(pureComponentPrototype, Component.prototype);
```
```js
// Avoid an extra prototype jump for these methods.
_assign(asyncComponentPrototype, Component.prototype);
```
æ¯å¥è¯ä¸Šé¢è¿˜ç‰¹æ„æœ‰ä¸ªæ³¨é‡Šï¼ŒAvoid an extra prototype jump for these methods.ï¼Œé¿å…è¿™äº›æ–¹æ³•é¢å¤–çš„åŸå‹è·³è½¬ï¼Œå…ˆä¸ç®¡å®ƒï¼Œå…ˆçœ‹_assignåšäº†ä»€ä¹ˆï¼Œ
æŠŠComponentçš„åŸå‹è·ŸAsyncComponentçš„åŸå‹åˆå¹¶ï¼Œ
é‚£ä¹ˆè¿™é‡Œç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œå¦‚æ­¤ä¸€æ¥ï¼ŒAsyncComponentä¸Šé¢çš„renderæ–¹æ³•ï¼Œä¸å°±ç›¸å½“äºæŒ‚è½½åˆ°Componentä¸Šé¢äº†å—ï¼Ÿ

ä»¥æ­¤ç±»æ¨ï¼Œä¸‰ç§åŸºç±»æ„é€ å™¨æœ€åéƒ½æ˜¯åŸºäºåŒä¸€ä¸ªåŸå‹ï¼Œå…±äº«æ‰€ä»¥æ–¹æ³•ï¼ŒåŒ…æ‹¬renderã€setStateã€forceUpdateç­‰ç­‰ï¼Œæœ€åçš„åŸå‹å›¾åº”è¯¥å°±å˜æˆäº†è¿™æ ·

![10](https://user-images.githubusercontent.com/25027560/36943157-bafe3bde-1fbe-11e8-98e8-9dbbdc9ad624.png)

åˆ°è¿™é‡Œï¼Œæœ‰ä¸ªé—®é¢˜è¦æ€è€ƒçš„æ˜¯ï¼Ÿ
æ—¢ç„¶æœ€åä¸‰ä¸ªåŸºç±»å…±ç”¨åŒä¸€ä¸ªåŸå‹ï¼Œé‚£ä¸ºä»€ä¹ˆè¦åˆ†å¼€æ¥å†™ï¼Ÿ
ä¸­é—´è¿˜é€šè¿‡ä¸€ä¸ªå‡ç»„ä»¶æ„é€ å™¨ComponentDummyæ¥è¾…åŠ©æ„å»ºä¸¤ä¸ªå®ä¾‹